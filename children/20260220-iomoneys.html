<!DOCTYPE html>
<html lang="auto">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<meta name="description" content="Â© 2024 NINS (by JPGT). By using any of the services, it means you have agreed to any content and all content!">
<link rel="canonical" href="https://copyright.nins.cc/">
<title translate="no">nins/io-money</title>

    <style>
        :root {
            --primary: #2563eb; 
            --inc-bg: #dcfce7; --inc-text: #059669; /* ç¶ è‰²ç³» */
            --exp-bg: #fee2e2; --exp-text: #dc2626; /* ç´…è‰²ç³» */
            --secondary: #64748b; --bg: #f8fafc; --dark: #1e293b;
        }

        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--dark); margin: 0; padding: 12px; }
        .container { max-width: 600px; margin: 0 auto; }

        /* ç¸½è¨ˆå¡ç‰‡ */
        .grand-total-card {
            background: #ffffff; padding: 24px; border-radius: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid #f1f5f9;
        }
        .balance-label { font-size: 0.85rem; color: var(--secondary); margin-bottom: 4px; font-weight: 500; }
        .balance-amount { font-size: 2.5rem; font-weight: 800; margin-bottom: 20px; color: var(--dark); }
        
        /* çµ±ä¸€çµç®—æ¨£å¼ (åƒè€ƒåœ–ç‰‡) */
        .badge {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 6px 12px; border-radius: 8px; font-weight: 700; font-size: 0.9rem;
            min-width: 80px; transition: 0.2s;
        }
        .badge-inc { background: var(--inc-bg); color: var(--inc-text); }
        .badge-exp { background: var(--exp-bg); color: var(--exp-text); }

        .stats-grid { display: flex; gap: 10px; border-top: 1px solid #f1f5f9; padding-top: 15px; }

        /* æ“ä½œåˆ— */
        .action-bar { display: flex; gap: 8px; margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; }
        .search-input { flex: 1; padding: 12px 18px; border: 2px solid #e2e8f0; border-radius: 16px; outline: none; transition: 0.3s; font-size: 1rem; }
        .search-input:focus { border-color: var(--primary); background: white; }
        .btn-icon { background: white; border: 2px solid #e2e8f0; padding: 0 14px; border-radius: 16px; cursor: pointer; color: var(--secondary); font-size: 1.2rem; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 0 24px; border-radius: 16px; font-weight: 700; cursor: pointer; }

        /* åˆ—è¡¨æ¨£å¼ */
        .list-container { display: flex; flex-direction: column; gap: 14px; }
        .day-group { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #f1f5f9; }
        .day-header { 
            background: #fdfdfd; padding: 14px 18px; display: flex; justify-content: space-between; 
            align-items: center; cursor: pointer; border-bottom: 1px solid #f8fafc;
        }
        .day-title { font-weight: 800; color: var(--dark); font-size: 0.95rem; }
        .day-summary { display: flex; gap: 6px; }
        .day-summary .badge { padding: 4px 10px; font-size: 0.8rem; min-width: 60px; }
        
        /* æŠ˜ç–Šå‹•ç•« */
        .items-wrapper { max-height: 5000px; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1; }
        .collapsed .items-wrapper { max-height: 0; opacity: 0; pointer-events: none; }
        .collapsed .day-header { border-bottom: none; }

        .item-row { 
            padding: 16px 18px; display: grid; grid-template-columns: 50px 1fr auto; 
            align-items: center; gap: 12px; border-bottom: 1px solid #fbfcfe; cursor: pointer;
        }
        .item-row:last-child { border-bottom: none; }
        .item-row:active { background: #f8fafc; }
        .item-time { font-size: 0.75rem; color: var(--secondary); font-weight: 500; }
        .item-desc { font-weight: 600; color: var(--dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item-amount { font-weight: 700; font-size: 1rem; }
        /* 2. æ ¸å¿ƒä¿®æ­£ï¼šå¼·åˆ¶èªªæ˜æ–‡å­—åœ¨ç©ºé–“ä¸è¶³æ™‚ç¸®æ¸›ä¸¦é¡¯ç¤ºçœç•¥è™Ÿ */
        .item-main {
            min-width: 0; /* é—œéµï¼é€™èƒ½é˜²æ­¢ Flex/Grid é …ç›®è¢«å…§å®¹æ’é–‹ */
        }
        .inc-text { color: var(--inc-text); }
        .exp-text { color: var(--exp-text); }

        /* å½ˆçª—æ¨£å¼ */
        .modal-overlay { position: fixed; inset: 0; background: rgba(30, 41, 59, 0.5); display: none; justify-content: center; align-items: flex-end; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-content { background: white; padding: 24px; border-radius: 24px 24px 0 0; width: 100%; max-width: 500px; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 0.75rem; color: var(--secondary); font-weight: 700; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; box-sizing: border-box; padding: 14px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem; background: #f8fafc; outline: none; }
        .modal-footer { display: flex; gap: 10px; margin-top: 24px; }
        .modal-footer button { flex: 1; padding: 16px; border-radius: 14px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-save { background: var(--primary); color: white; }
        .btn-cancel { background: #f1f5f9; color: var(--secondary); }
        
        .util-btns { display: flex; justify-content: center; gap: 20px; margin: 40px 0; }
        .btn-util { background: none; border: none; font-size: 0.8rem; cursor: pointer; color: var(--secondary); text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <div class="grand-total-card">
        <div class="balance-label" id="footer-label">ç›®å‰çš„é ç®—çµé¤˜</div>
        <div class="balance-amount">$ <span id="footer-bal">0</span></div>
        <div class="stats-grid">
            <div class="badge badge-inc">+ <span id="footer-inc">0</span></div>
            <div class="badge badge-exp">- <span id="footer-exp">0</span></div>
        </div>
    </div>

    <div class="action-bar">
        <button onclick="toggleAllGroups()" class="btn-icon" id="toggleBtn">â†•</button>
        <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” æœå°‹ç´€éŒ„..." oninput="render()">
        <button onclick="openModal()" class="btn-add">ï¼‹ æ–°å¢</button>
    </div>

    <div id="list" class="list-container"></div>

    <div class="util-btns">
        <button onclick="exportTXT()" class="btn-util">åŒ¯å‡ºå‚™ä»½</button>
        <button onclick="document.getElementById('fileInput').click()" class="btn-util">åŒ¯å…¥è³‡æ–™</button>
        <button onclick="clearAll()" class="btn-util" style="color:var(--danger)">æ¸…ç©ºæ‰€æœ‰</button>
        <input type="file" id="fileInput" accept=".txt" style="display:none">
    </div>
</div>

<div id="modal" class="modal-overlay">
    <div class="modal-content">
        <div class="form-group">
            <label>æ™‚é–“</label>
            <div style="display:flex; gap:10px;">
                <input type="date" id="m-date" style="flex:2">
                <input type="time" id="m-time" style="flex:1">
            </div>
        </div>
        <div class="form-group">
            <label>é¡å‹èˆ‡é‡‘é¡</label>
            <div style="display:flex; gap:10px;">
                <select id="m-type" style="flex:1">
                    <option value="expense">æ”¯å‡º</option>
                    <option value="income">æ”¶å…¥</option>
                </select>
                <input type="number" id="m-amount" placeholder="0" style="flex:2">
            </div>
        </div>
        <div class="form-group">
            <label>å‚™è¨»</label>
            <textarea id="m-desc" rows="2" placeholder="ä»Šå¤©è²·äº†ä»€éº¼ï¼Ÿ"></textarea>
        </div>
        <div class="modal-footer">
            <button id="m-delete-btn" onclick="deleteEntry()" style="background:#fee2e2; color:#ef4444; display:none;">åˆªé™¤</button>
            <button onclick="closeModal()" class="btn-cancel">å–æ¶ˆ</button>
            <button onclick="saveEntry()" class="btn-save">å„²å­˜ç´€éŒ„</button>
        </div>
    </div>
</div>

<script>
const KEY="accountBookUTC_v3"; 
let data=JSON.parse(localStorage.getItem(KEY))||[];
let currentEditId = null;
let isAllExpanded = true;

function toggleAllGroups() { isAllExpanded = !isAllExpanded; render(); }
function toggleSingleGroup(element) { element.parentElement.classList.toggle('collapsed'); }

function openModal(id = null) {
    const modal = document.getElementById("modal");
    const delBtn = document.getElementById("m-delete-btn");
    if(id) {
        currentEditId = id;
        const item = data.find(i => i.id === id);
        document.getElementById("m-date").value = item.date;
        document.getElementById("m-time").value = item.time || "00:00";
        document.getElementById("m-type").value = item.type;
        document.getElementById("m-amount").value = item.amount;
        document.getElementById("m-desc").value = item.desc;
        delBtn.style.display = "block";
    } else {
        currentEditId = null;
        const now = new Date();
        document.getElementById("m-date").value = now.toISOString().split("T")[0];
        document.getElementById("m-time").value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        document.getElementById("m-type").value = "expense";
        document.getElementById("m-amount").value = "";
        document.getElementById("m-desc").value = "";
        delBtn.style.display = "none";
    }
    modal.style.display = "flex";
}

function closeModal() { document.getElementById("modal").style.display = "none"; }
window.onclick = (e) => { if(e.target == document.getElementById("modal")) closeModal(); }

function saveEntry() {
    const date = document.getElementById("m-date").value;
    const time = document.getElementById("m-time").value;
    const type = document.getElementById("m-type").value;
    const amount = parseFloat(document.getElementById("m-amount").value);
    const desc = document.getElementById("m-desc").value;
    if(!desc || isNaN(amount)) return alert("è«‹å®Œæ•´å¡«å¯«");
    if(currentEditId) {
        const idx = data.findIndex(i => i.id === currentEditId);
        data[idx] = { ...data[idx], date, time, type, amount, desc };
    } else {
        data.push({ id: Date.now(), date, time, type, amount, desc });
    }
    finalize(); closeModal();
}

function deleteEntry() { if(confirm("ç¢ºå®šåˆªé™¤é€™ç­†ç´€éŒ„ï¼Ÿ")) { data = data.filter(i => i.id !== currentEditId); finalize(); closeModal(); } }
function finalize() { localStorage.setItem(KEY, JSON.stringify(data)); render(); }
function clearAll() { if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿ")) { data = []; finalize(); } }

function render() {
    const searchTerm = document.getElementById("searchInput").value.toLowerCase();
    data.sort((a,b) => b.date.localeCompare(a.date) || (b.time||"").localeCompare(a.time||""));
    const filtered = data.filter(i => i.desc.toLowerCase().includes(searchTerm));
    const list = document.getElementById("list");
    list.innerHTML = "";

    let tInc = 0, tExp = 0;
    const groups = filtered.reduce((acc, i) => { acc[i.date] = acc[i.date] || []; acc[i.date].push(i); return acc; }, {});

    Object.keys(groups).sort().reverse().forEach(date => {
        let dInc = 0, dExp = 0;
        const itemsHtml = groups[date].map(item => {
            const isInc = item.type === "income";
            isInc ? dInc += item.amount : dExp += item.amount;
            isInc ? tInc += item.amount : tExp += item.amount;
            return `
                <div class="item-row" onclick="event.stopPropagation(); openModal(${item.id})">
                    <div class="item-time">${item.time || '00:00'}</div>
                    <div class="item-main"><div class="item-desc">${item.desc}</div></div>
                    <div class="item-amount ${isInc?'inc-text':'exp-text'}">${isInc?'+':'-'}${item.amount.toLocaleString()}</div>
                </div>`;
        }).join('');

        const groupDiv = document.createElement('div');
        groupDiv.className = `day-group ${isAllExpanded ? '' : 'collapsed'}`;
        groupDiv.innerHTML = `
            <div class="day-header" onclick="toggleSingleGroup(this)">
                <div class="day-title">ğŸ“… ${date}</div>
                <div class="day-summary">
                    <div class="badge badge-inc">+${dInc.toLocaleString()}</div>
                    <div class="badge badge-exp">-${dExp.toLocaleString()}</div>
                </div>
            </div>
            <div class="items-wrapper">${itemsHtml}</div>`;
        list.appendChild(groupDiv);
    });

    document.getElementById("footer-inc").innerText = tInc.toLocaleString();
    document.getElementById("footer-exp").innerText = tExp.toLocaleString();
    document.getElementById("footer-bal").innerText = (tInc - tExp).toLocaleString();
    document.getElementById("toggleBtn").innerText = isAllExpanded ? "âŠ–" : "âŠ•";
}

function exportTXT() {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `Account_Backup_${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
}

document.getElementById("fileInput").onchange = (e) => {
    const reader = new FileReader();
    reader.onload = () => { try { data = JSON.parse(reader.result); finalize(); } catch(e) { alert("æª”æ¡ˆæ ¼å¼éŒ¯èª¤"); } };
    reader.readAsText(e.target.files[0]);
};

render();
</script>
</body>
</html>
