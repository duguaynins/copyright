<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<meta name="description" content="Â© 2024 NINS (by JPGT).">
<title translate="no">nins/io-money</title>

    <style>
        
        :root {
            --primary: #2563eb; 
            --bal-bg: #dbeafe; --bal-text: #1e40af;
            --inc-bg: #dcfce7; --inc-text: #059669; 
            --exp-bg: #fee2e2; --exp-text: #dc2626; 
            --secondary: #64748b; --bg: #f8fafc; --dark: #1e293b;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* ç•¶é¸ä¸­æ”¶å…¥æ™‚å¥—ç”¨çš„é¡è‰² */
        .select-income { 
            color: var(--inc-text) !important; 
            border-color: var(--inc-text) !important;
            font-weight: 700;
        }

        /* ç•¶é¸ä¸­æ”¯å‡ºæ™‚å¥—ç”¨çš„é¡è‰² */
        .select-expense { 
            color: var(--exp-text) !important; 
            border-color: var(--exp-text) !important;
            font-weight: 700;
        }

        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--dark); 
            margin: 0; 
            padding: 16px; 
        }

        .container { 
            max-width: 600px; 
            margin: 0 auto; 
        }

        /* ç¸½è¨ˆå¡ç‰‡ */
        .grand-total-card {
            background: #ffffff; 
            padding: 24px; 
            border-radius: 24px;
            box-shadow: var(--card-shadow); 
            margin-bottom: 20px;
            border: 1px solid #f1f5f9;
        }
        .balance-label { font-size: 0.85rem; color: var(--secondary); margin-bottom: 4px; font-weight: 500; }
        .balance-amount { 
            font-size: clamp(1.8rem, 5vw, 2.5rem); 
            font-weight: 800; 
            margin-bottom: 20px; 
            color: var(--dark); 
        }
        
        .badge {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 6px 12px; border-radius: 8px; font-weight: 700; font-size: 0.9rem;
            min-width: 80px; transition: 0.2s;
        }
        .badge-inc { background: var(--inc-bg); color: var(--inc-text); }
        .badge-exp { background: var(--exp-bg); color: var(--exp-text); }
        .badge-bal { 
    background: var(--bal-bg); 
    color: var(--bal-text); 
    padding: 4px 12px; 
    border-radius: 12px; 
    display: inline-block; /* è®“åº•è‰²ç·Šè²¼æ–‡å­— */
}

        .stats-grid { display: flex; gap: 10px; border-top: 1px solid #f1f5f9; padding-top: 15px; }

        /* æ“ä½œåˆ— - çµ±ä¸€é«˜åº¦èˆ‡é›»è…¦ç‰ˆå„ªåŒ– */
        .action-bar { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 20px; 
            position: sticky; 
            top: 10px; 
            z-index: 100;
            background: var(--bg);
            padding: 4px 0;
        }
        .search-input, .btn-icon, .btn-add {
            height: 48px;
            box-sizing: border-box;
        }
        .search-input { 
            flex: 1;           /* è®“å®ƒä½”æ»¿å‰©é¤˜ç©ºé–“ */
            width: 0;          /* è§£æ±ºæŸäº›ç€è¦½å™¨é è¨­å¯¬åº¦çš„å•é¡Œ */
            min-width: 0;      /* è§£æ±º Flexbox çš„éš±å½¢æœ€å°å¯¬åº¦å•é¡Œ */
            height: 48px;      /* ä¿æŒé«˜åº¦çµ±ä¸€ */
            padding: 0 18px; 
            border: 2px solid #e2e8f0; 
            border-radius: 16px; 
            outline: none; 
            transition: 0.3s; 
            font-size: 1rem; 
        }
        .search-input:focus { border-color: var(--primary); background: white; }
        .btn-icon { 
            background: white; 
            border: 2px solid #e2e8f0; 
            width: 48px;
            border-radius: 16px; 
            cursor: pointer; 
            color: var(--secondary); 
            font-size: 1.2rem; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-add { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 0 20px; 
            border-radius: 16px; 
            font-weight: 700; 
            cursor: pointer; 
            white-space: nowrap;
        }

        /* åˆ—è¡¨æ¨£å¼ */
        .list-container { display: flex; flex-direction: column; gap: 14px; }
        .day-group { 
            background: white; 
            border-radius: 20px; 
            overflow: hidden; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); 
            border: 1px solid #f1f5f9; 
        }
        .day-header { 
            background: #fdfdfd; padding: 14px 18px; display: flex; justify-content: space-between; 
            align-items: center; cursor: pointer; border-bottom: 1px solid #f8fafc;
        }
        .day-title { font-weight: 800; color: var(--dark); font-size: 0.95rem; }
        .day-summary { display: flex; gap: 6px; }
        .day-summary .badge { padding: 4px 10px; font-size: 0.8rem; min-width: 60px; }
        
        .items-wrapper { max-height: 5000px; transition: all 0.4s ease; opacity: 1; }
        .collapsed .items-wrapper { max-height: 0; opacity: 0; pointer-events: none; }
        .collapsed .day-header { border-bottom: none; }

        .item-row { 
            padding: 16px 18px; 
            display: grid; 
            grid-template-columns: 60px 1fr auto; 
            align-items: center; 
            gap: 12px; 
            border-bottom: 1px solid #fbfcfe; 
            cursor: pointer;
            transition: background 0.2s;
        }
        .item-row:last-child { border-bottom: none; }
        .item-row:hover { background: #f8fafc; }
        
        .item-time { font-size: 0.75rem; color: var(--secondary); font-weight: 500; }
        .item-main { min-width: 0; }
        .item-desc { font-weight: 600; color: var(--dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item-amount { font-weight: 700; font-size: 1rem; }
        .inc-text { color: var(--inc-text); }
        .exp-text { color: var(--exp-text); }

        /* å½ˆçª—æ¨£å¼ - é›»è…¦ç‰ˆç½®ä¸­ */
        .modal-overlay { 
            position: fixed; 
            inset: 0; 
            background: rgba(30, 41, 59, 0.5); 
            display: none; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            backdrop-filter: blur(4px); 
        }
        .modal-content { 
            background: white; 
            padding: 24px; 
            border-radius: 24px; 
            width: 90%; 
            max-width: 450px; 
            animation: modalFade 0.3s ease-out; 
        }

        @keyframes modalFade { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* æ‰‹æ©Ÿç‰ˆå½ˆçª—å„ªåŒ– */
        @media (max-width: 480px) {
            .modal-overlay { align-items: flex-end; }
            .modal-content { border-radius: 24px 24px 0 0; width: 100%; }
        }

        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 0.75rem; color: var(--secondary); font-weight: 700; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; box-sizing: border-box; padding: 14px; border: 1px solid #e2e8f0; 
            border-radius: 12px; font-size: 1rem; background: #f8fafc; outline: none; 
        }
        .modal-footer { display: flex; gap: 10px; margin-top: 24px; }
        .modal-footer button { flex: 1; padding: 16px; border-radius: 14px; border: none; font-weight: 700; cursor: pointer; }
        .btn-save { background: var(--primary); color: white; }
        .btn-cancel { background: #f1f5f9; color: var(--secondary); }
        
        .util-btns { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin: 40px 0; }
        .btn-util { background: none; border: none; font-size: 0.8rem; cursor: pointer; color: var(--secondary); text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">

    <div class="action-bar">
        <button onclick="toggleAllGroups()" class="btn-icon" id="toggleBtn">â†•</button>
        <input type="text" id="searchInput" class="search-input" placeholder="ğŸ”" oninput="render()">
        <button onclick="openModal()" class="btn-add">ğŸ“„</button>
    </div>
    
    <div class="grand-total-card">
        <div class="balance-label" style="display: none;">ç›®å‰çš„é ç®—çµé¤˜</div>
        <div class="balance-amount badge-bal">$ <span id="footer-bal">0</span></div>
        <div class="stats-grid">
            <div class="badge badge-inc">+ <span id="footer-inc">0</span></div>
            <div class="badge badge-exp">- <span id="footer-exp">0</span></div>
        </div>
    </div>

    <div id="list" class="list-container"></div>

    <div class="util-btns">
        <button onclick="exportTXT()" class="btn-util">åŒ¯å‡ºå‚™ä»½</button>
        <button onclick="document.getElementById('fileInput').click()" class="btn-util">åŒ¯å…¥è³‡æ–™</button>
        <button onclick="clearAll()" class="btn-util" style="color:#ef4444">æ¸…ç©ºæ‰€æœ‰</button>
        <input type="file" id="fileInput" accept=".txt" style="display:none">
    </div>
</div>

<div id="modal" class="modal-overlay">
    <div class="modal-content">
        <div class="form-group">
            <label>æ™‚é–“</label>
            <div style="display:flex; gap:10px;">
                <input type="date" id="m-date" style="flex:2">
                <input type="time" id="m-time" style="flex:1">
            </div>
        </div>
        <div class="form-group">
            <label>é¡å‹èˆ‡é‡‘é¡</label>
            <div style="display:flex; gap:10px;">
                <select id="m-type" style="flex:1" onchange="updateSelectColor()" class="select-income">
                    <option value="income">ï¼‹</option>
                    <option value="expense">ï¼</option>
                </select>
                <input type="number" id="m-amount" placeholder="0" style="flex:2">
            </div>
        </div>
        <div class="form-group">
            <label>å‚™è¨»</label>
            <textarea id="m-desc" rows="2" placeholder="ä»Šå¤©è²·äº†ä»€éº¼ï¼Ÿ"></textarea>
        </div>
        <div class="modal-footer">
            <button id="m-delete-btn" onclick="deleteEntry()" style="background:#fee2e2; color:#ef4444; display:none;">åˆªé™¤</button>
            <button onclick="closeModal()" class="btn-cancel">å–æ¶ˆ</button>
            <button onclick="saveEntry()" class="btn-save">å„²å­˜ç´€éŒ„</button>
        </div>
    </div>
</div>

<script>
/* æ ¸å¿ƒ JavaScript é‚è¼¯ä¿ç•™è‡ªåŸå§‹æª”æ¡ˆ */
const KEY="accountBookUTC_v3"; 
let data=JSON.parse(localStorage.getItem(KEY))||[];
let currentEditId = null;
let isAllExpanded = true;

function toggleAllGroups() { isAllExpanded = !isAllExpanded; render(); }
function toggleSingleGroup(element) { element.parentElement.classList.toggle('collapsed'); }

function openModal(id = null) {

    const modal = document.getElementById("modal");
    const delBtn = document.getElementById("m-delete-btn");
    if(id) {
        currentEditId = id;
        const item = data.find(i => i.id === id);
        document.getElementById("m-date").value = item.date;
        document.getElementById("m-time").value = item.time || "00:00";
        document.getElementById("m-type").value = item.type;
        document.getElementById("m-amount").value = item.amount;
        document.getElementById("m-desc").value = item.desc;
        delBtn.style.display = "block";
    } else {
        currentEditId = null;
        const now = new Date();
        document.getElementById("m-date").value = now.toISOString().split("T")[0];
        document.getElementById("m-time").value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        document.getElementById("m-type").value = "income";
        document.getElementById("m-amount").value = "";
        document.getElementById("m-desc").value = "";
        delBtn.style.display = "none";
    }
    modal.style.display = "flex";
    updateSelectColor()  //20260220_1436
}

function closeModal() { document.getElementById("modal").style.display = "none"; }
window.onclick = (e) => { if(e.target == document.getElementById("modal")) closeModal(); }

function saveEntry() {
    const date = document.getElementById("m-date").value;
    const time = document.getElementById("m-time").value;
    const type = document.getElementById("m-type").value;
    const amount = parseFloat(document.getElementById("m-amount").value);
    const desc = document.getElementById("m-desc").value;
    if(!desc || isNaN(amount)) return alert("è«‹å®Œæ•´å¡«å¯«");
    if(currentEditId) {
        const idx = data.findIndex(i => i.id === currentEditId);
        data[idx] = { ...data[idx], date, time, type, amount, desc };
    } else {
        data.push({ id: Date.now(), date, time, type, amount, desc });
    }
    finalize(); closeModal();
}

function deleteEntry() { if(confirm("ç¢ºå®šåˆªé™¤é€™ç­†ç´€éŒ„ï¼Ÿ")) { data = data.filter(i => i.id !== currentEditId); finalize(); closeModal(); } }
function finalize() { localStorage.setItem(KEY, JSON.stringify(data)); render(); }
function clearAll() { if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿ")) { data = []; finalize(); } }

function render() {
    const searchTerm = document.getElementById("searchInput").value.toLowerCase();
    data.sort((a,b) => b.date.localeCompare(a.date) || (b.time||"").localeCompare(a.time||""));
    const filtered = data.filter(i => i.desc.toLowerCase().includes(searchTerm));
    const list = document.getElementById("list");
    list.innerHTML = "";

    let tInc = 0, tExp = 0;
    const groups = filtered.reduce((acc, i) => { acc[i.date] = acc[i.date] || []; acc[i.date].push(i); return acc; }, {});

    Object.keys(groups).sort().reverse().forEach(date => {
        let dInc = 0, dExp = 0;
        const itemsHtml = groups[date].map(item => {
            const isInc = item.type === "income";
            isInc ? dInc += item.amount : dExp += item.amount;
            isInc ? tInc += item.amount : tExp += item.amount;
            return `
                <div class="item-row" onclick="event.stopPropagation(); openModal(${item.id})">
                    <div class="item-time">${item.time || '00:00'}</div>
                    <div class="item-main"><div class="item-desc">${item.desc}</div></div>
                    <div class="item-amount ${isInc?'inc-text':'exp-text'}">${isInc?'+':'-'}${item.amount.toLocaleString()}</div>
                </div>`;
        }).join('');

        const groupDiv = document.createElement('div');  ///ğŸ”²ğŸ”³
        groupDiv.className = `day-group ${isAllExpanded ? '' : 'collapsed'}`;
        groupDiv.innerHTML = `
            <div class="day-header" onclick="toggleSingleGroup(this)">
                <div class="day-title">ğŸ”³ ${date}</div>
                <div class="day-summary">
                    <div class="badge badge-inc">+${dInc.toLocaleString()}</div>
                    <div class="badge badge-exp">-${dExp.toLocaleString()}</div>
                </div>
            </div>
            <div class="items-wrapper">${itemsHtml}</div>`;
        list.appendChild(groupDiv);
    });

    document.getElementById("footer-inc").innerText = tInc.toLocaleString();
    document.getElementById("footer-exp").innerText = tExp.toLocaleString();
    document.getElementById("footer-bal").innerText = (tInc - tExp).toLocaleString();
    document.getElementById("toggleBtn").innerText = isAllExpanded ? "âŠ–" : "âŠ•";
}

function exportTXT() {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `Account_Backup_${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
}

document.getElementById("fileInput").onchange = (e) => {
    const reader = new FileReader();
    reader.onload = () => { try { data = JSON.parse(reader.result); finalize(); } catch(e) { alert("æª”æ¡ˆæ ¼å¼éŒ¯èª¤"); } };
    reader.readAsText(e.target.files[0]);
};

function updateSelectColor() {
    const select = document.getElementById("m-type");
    if (select.value === "income") {
        ///select.style.background = "green";
        select.classList.add("select-income");
        select.classList.remove("select-expense");
    } else {
        ///select.style.background = "red";
        select.classList.add("select-expense");
        select.classList.remove("select-income");
    }
}

render();
</script>
</body>
</html>
