<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .board {
            display: grid;
            grid-template-columns: 100px repeat(4, 80px) 100px; /* 100 + 80*4 + 100 = 520px */
            grid-template-rows: 100px repeat(4, 80px) 100px;     /* 100 + 80*4 + 100 = 520px */
            width: 520px;
            height: 520px;
            border: 5px solid #2d3748;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            margin: 20px auto;
            position: relative;
            box-sizing: border-box;
            border-radius: 1rem;
            overflow: hidden;
        }
        .square {
            border: 1px solid #a0aec0;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 10px;
            background-color: #f7fafc;
            position: relative;
            box-sizing: border-box;
            padding: 2px;
            color: #2d3748;
            font-weight: 500;
        }
        .corner { font-size: 14px; font-weight: bold; background-color: #bee3f8; color: #2b6cb0; }
        .property::before {
            content: "";
            position: absolute;
            background-color: #ecc94b;
        }

        .property.top::before { top: 0; left: 0; width: 100%; height: 15px; border-bottom: 1px solid #a0aec0; }
        .property.left::before { top: 0; left: 0; width: 15px; height: 100%; border-right: 1px solid #a0aec0; }
        .property.bottom::before { bottom: 0; left: 0; width: 100%; height: 15px; border-top: 1px solid #a0aec0; }
        .property.right::before { top: 0; right: 0; width: 15px; height: 100%; border-left: 1px solid #a0aec0; }
        #square-0 { background-color: #c6f6d5; color: #276749; grid-area: 1 / 6 / 2 / 7; } /* å³ä¸Šè§’ */
        #square-4 { background-color: #fed7d7; color: #9b2c2c; grid-area: 1 / 1 / 2 / 2; } /* å·¦ä¸Šè§’ */
        #square-15 { background-color: #fed7d7; color: #9b2c2c; grid-area: 6 / 1 / 7 / 2; }
        #square-11 { background-color: #c3dafe; color: #3182ce; grid-area: 6 / 6 / 7 / 7; }
        #square-1 { grid-area: 1 / 5 / 2 / 6; }
        #square-2 { grid-area: 1 / 4 / 2 / 5; }
        #square-3 { grid-area: 1 / 3 / 2 / 4; }
        #square-19 { grid-area: 2 / 1 / 3 / 2; }
        #square-18 { grid-area: 3 / 1 / 4 / 2; }
        #square-17 { grid-area: 4 / 1 / 5 / 2; }
        #square-16 { grid-area: 5 / 1 / 6 / 2; }
        #square-14 { grid-area: 6 / 2 / 7 / 3; }
        #square-13 { grid-area: 6 / 3 / 7 / 4; }
        #square-12 { grid-area: 6 / 4 / 7 / 5; }
        #square-10 { grid-area: 5 / 6 / 6 / 7; }
        #square-9 { grid-area: 4 / 6 / 5 / 7; }
        #square-8 { grid-area: 3 / 6 / 4 / 7; }
        #square-7 { grid-area: 2 / 6 / 3 / 7; }
        .center-area { grid-area: 2 / 2 / 6 / 6; background-color: #fff; }
        
        .player-token { width: 28px; height: 28px; border-radius: 50%; color: white; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: 700; position: absolute; transition: all 0.7s ease-in-out; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); z-index: 10; }
        

    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center m-0 p-0">

    <div class="board">
        <div class="square corner start" id="square-0">èµ·é»</div>
        <div class="square property top" id="square-1">åœ°ç”¢ 1</div>
        <div class="square property top" id="square-2">åœ°ç”¢ 2</div>
        <div class="square card top" id="square-3">ç©å®¶äº¤æ˜“</div>
        <div class="square corner jail" id="square-4">ç›£ç„ / åªæ˜¯æ‹œè¨ª</div>
        <div class="square property left" id="square-7">åœ°ç”¢ 12</div>
        <div class="square property left" id="square-8">åœ°ç”¢ 13</div>
        <div class="square card left" id="square-9">å‘½é‹</div>
        <div class="square property left" id="square-10">åœ°ç”¢ 14</div>
        <div class="square corner goto-jail" id="square-11">å»ç›£ç„</div>
        <div class="square utility bottom" id="square-12">å…¬å…±äº‹æ¥­</div>
        <div class="square tax bottom" id="square-13">ç¦åœ°ç½°é‡‘</div>
        <div class="square property bottom" id="square-14">åœ°ç”¢ 15</div>
        <div class="square corner parking" id="square-15">å…è²»åœè»Š</div>
        <div class="square property right" id="square-16">åœ°ç”¢ 5</div>
        <div class="square card right" id="square-17">æ©Ÿæœƒ</div>
        <div class="square property right" id="square-18">åœ°ç”¢ 4</div>
        <div class="square property right" id="square-19">åœ°ç”¢ 3</div>
        <!--div class="square property right" id="square-5">å‘½ä»¤</div-->
        <!--div class="square property right" id="square-6">è«‹æ±‚</div-->
        
        <div class="center-area p-8 flex flex-col justify-around items-center rounded-lg shadow-inner">
            <h2 id="status" class="text-xl font-semibold text-gray-700">ç©å®¶ 1 çš„å›åˆ</h2>
            <div id="dice-result" class="text-5xl font-extrabold text-indigo-600 my-4">ğŸ²</div>
            <button id="roll-dice" class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105">æ“²éª°å­</button>
            <div id="system" class="mt-4 text-sm text-gray-500">ï¼ˆé»æ“ŠæŒ‰éˆ•ç§»å‹• P1 æˆ– P2ï¼‰</div>
        </div>
        <div class="player-token" id="player-1-token" style="background-color: #f56565;">P1</div>
        <div class="player-token" id="player-2-token" style="background-color: #4299e1;">P2</div>
    </div>

    <script>
        /*
        let currentPlayer = 1;
        let playerPositions = { 1: 0, 2: 0 };
        const numSquares = 20;
        const rollDiceButton = document.getElementById('roll-dice');
        const diceResultDiv = document.getElementById('dice-result');
        const statusDiv = document.getElementById('status');
        const player1Token = document.getElementById('player-1-token');
        const player2Token = document.getElementById('player-2-token');*/
        const cornerSize = 100;
        const normalSize = 80;
        const boardSize = 620;

        /*
        const getSquareCenter = (index) => {
            let x = 0, y = 0;
            if (index >= 0 && index <= 4) {
                y = cornerSize / 2;
                x = boardSize - cornerSize - (index === 0 ? 0 : index * normalSize) + normalSize / 2;
            } else if (index >= 7 && index <= 10) {
                x = boardSize - cornerSize / 2;
                y = (index - 6) * normalSize + cornerSize / 2;
            } else if (index >= 11 && index <= 15) {
                y = boardSize - cornerSize / 2;
                x = cornerSize / 2 + (index - 15) * normalSize;
            } else if (index >= 16 && index <= 19) {
                x = cornerSize / 2;
                y = boardSize - cornerSize - (index - 16) * normalSize + normalSize / 2;
            }
            return { x, y };
        };*/
        // ç¯„ä¾‹æ£‹ç›¤è¨­å®š

        /**
         * æ ¹æ“šæ ¼å­ç´¢å¼•è¨ˆç®—æ£‹å­ä¸­å¿ƒåº§æ¨™
         * @param {number} index - æ ¼å­ç´¢å¼• 0~19
         * @returns {{x: number, y: number}}
         */

        /*
        function getSquareCenter(index) {
            let x, y;

            if (index >= 0 && index <= 4) { // ä¸Šå´
                y = cornerSize / 2;
                if (index === 0) x = boardSize - cornerSize / 2;          // å³ä¸Šè§’
                else if (index === 4) x = cornerSize / 2;                 // å·¦ä¸Šè§’
                else x = boardSize - cornerSize - (index - 1) * normalSize - normalSize / 2; // ä¸­é–“
            }
            else if (index >= 5 && index <= 10) { // å³å´
                x = boardSize - cornerSize / 2;
                if (index === 10) y = boardSize - cornerSize / 2;         // å³ä¸‹è§’
                else y = cornerSize + (index - 5) * normalSize + normalSize / 2; // ä¸­é–“æ ¼
            }
            else if (index >= 11 && index <= 15) { // ä¸‹å´
                y = boardSize - cornerSize / 2;
                if (index === 11) x = boardSize - cornerSize / 2;        // å³ä¸‹è§’
                else if (index === 15) x = cornerSize / 2;               // å·¦ä¸‹è§’
                else x = cornerSize + (index - 12) * normalSize + normalSize / 2; // ä¸­é–“
            }
            else if (index >= 16 && index <= 19) { // å·¦å´
                x = cornerSize / 2;
                if (index === 16) y = boardSize - cornerSize / 2;        // å·¦ä¸‹è§’
                else y = boardSize - cornerSize - (index - 17) * normalSize - normalSize / 2; // ä¸­é–“
            }

            return { x, y };
        }*/
       
        /*
        const squareCenters = [
            {x: 420, y: 420}, // èµ·é»
            {x: 360, y: 420}, // åœ°ç”¢1
            {x: 300, y: 420}, // åœ°ç”¢2
            {x: 240, y: 420}, // åœ°ç”¢3
            {x: 180, y: 420}, // åœ°ç”¢4
            {x: 120, y: 360}, // æ©Ÿæœƒ
            {x: 120, y: 300}, // å…è²»åœè»Š
            {x: 120, y: 240}, // åœ°ç”¢5
            {x: 120, y: 180}, // åœ°ç”¢6
            {x: 180, y: 120}, // åœ°ç”¢7
            {x: 240, y: 120}, // æ©Ÿæœƒ
            {x: 300, y: 120}, // åœ°ç”¢8
            {x: 360, y: 120}, // åœ°ç”¢9
            {x: 420, y: 120}, // å‘½é‹
            {x: 420, y: 180}, // åœ°ç”¢10
            {x: 420, y: 240}, // å»ç›£ç„
            {x: 420, y: 300}, // å…¬å…±äº‹æ¥­
            {x: 420, y: 360}, // ç¨…é‡‘
            {x: 360, y: 360}, // åœ°ç”¢15
            {x: 300, y: 360}, // ç›£ç„/åªæ˜¯æ‹œè¨ª
        ];

        function getSquareCenter(index) {
            return squareCenters[index % 20];
        }*/
        /*
        function getSquareCenter(index) {
            let x, y;

            // ä¸Šé‚Š (å³ä¸Šåˆ°å·¦ä¸Š)
            if (index >= 0 && index <= 4) {
                y = 50; // ä¸Šé‚Šè§’æ ¼ä¸€åŠ
                switch(index) {
                    case 0: x = 570; break; // èµ·é»
                    case 1: x = 490; break;
                    case 2: x = 410; break;
                    case 3: x = 330; break;
                    case 4: x = 50; break; // å·¦ä¸Šè§’
                }
            }
            // å·¦é‚Š (ä¸Šå·¦åˆ°ä¸‹å·¦)
            else if (index >= 5 && index <= 10) {
                x = 50; // å·¦å´è§’æ ¼
                y = 50 + (index - 5 + 1) * 80 - 40; // æ¯æ ¼ä¸­å¿ƒ
                if(index === 10) y = 570; // å·¦ä¸‹è§’
            }
            // ä¸‹é‚Š (å·¦ä¸‹åˆ°å³ä¸‹)
            else if (index >= 11 && index <= 15) {
                y = 570; // ä¸‹é‚Šè§’æ ¼
                x = 50 + (index - 11 + 1) * 80 - 40;
                if(index === 11) x = 50; // å·¦ä¸‹è§’
                if(index === 15) x = 570; // å³ä¸‹è§’
            }
            // å³é‚Š (ä¸‹å³åˆ°ä¸Šå³)
            else if (index >= 16 && index <= 19) {
                x = 570; // å³å´è§’æ ¼
                y = 50 + (19 - index + 1) * 80 - 40;
                if(index === 16) y = 330;
                if(index === 19) y = 50;
            }

            return { x, y };
        }*/

        /*// v0
        const movePlayerToken = (player, newPos) => {
            const token = (player === 1) ? player1Token : player2Token;
            const coords = getSquareCenter(newPos);
            const tokenHalf = 14;
            const offset = (player === 2) ? 14 : -14;
            token.style.left = `${coords.x - tokenHalf + offset/2}px`;
            token.style.top = `${coords.y - tokenHalf}px`;
        };*/
        /*// v1
        const movePlayerToken = (player, newPos) => {
            const token = player === 1 ? player1Token : player2Token;
            const coords = getSquareCenter(newPos);
            const offsetX = player === 1 ? -14 : 14; // ç©å®¶1/2 å·¦å³åç§»
            token.style.left = `${coords.x - 14 + offsetX}px`;
            token.style.top = `${coords.y - 14}px`;
        };*/
        let currentPlayer = 1;
        let playerPositions = { 1: 0, 2: 0 };
        // The HTML defines 18 squares: 0, 1, 2, 3, 4, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19
        // To fix the move path, we must use the actual number of squares defined.
        // The indices are 0-4 (5), 7-10 (4), 11-15 (5), 16-19 (4) -> Total 18 squares.
        // **IMPORTANT:** Since your existing `rollDice` uses indices 0-19 with modulo 20, 
        // the easiest fix is to change the square-ID mapping so it's consecutive (0-17).
        // However, if we must stick to the existing HTML IDs, we need to map them.

        // Let's create a *correct* ordered list of square IDs for a counter-clockwise path,
        // starting from 'square-0' (Start/å³ä¸Šè§’).
        const correctSquareOrder = [
            'square-0', 'square-7', 'square-8', 'square-9', 'square-10', // Right Side (0-4)
            'square-11', // Right-Bottom Corner (5)
            'square-12', 'square-13', 'square-14', // Bottom Side (6-8)
            'square-15', // Left-Bottom Corner (9)
            'square-16', 'square-17', 'square-18', 'square-19', // Left Side (10-13)
            'square-4', // Left-Top Corner (14)
            'square-3', 'square-2', 'square-1' // Top Side (15-17)
        ];
        const numSquares = correctSquareOrder.length; // Will be 18

        const rollDiceButton = document.getElementById('roll-dice');
        const diceResultDiv = document.getElementById('dice-result');
        const statusDiv = document.getElementById('status');
        const player1Token = document.getElementById('player-1-token');
        const player2Token = document.getElementById('player-2-token');

        /**
         * æ ¹æ“šæ ¼å­åœ¨ correctSquareOrder ä¸­çš„ç´¢å¼•è¨ˆç®—æ£‹å­ä¸­å¿ƒåº§æ¨™
         * @param {number} pathIndex - åœ¨ correctSquareOrder ä¸­çš„ç´¢å¼• (0 åˆ° 17)
         * @returns {{x: number, y: number}} ç›¸å°æ–¼ .board å®¹å™¨çš„ä¸­å¿ƒåº§æ¨™
         */
        function getSquareCenter(pathIndex) {
            const squareId = correctSquareOrder[pathIndex];
            const squareElement = document.getElementById(squareId);

            if (squareElement) {
                // center of the square is its offset + half of its current size
                // For corner squares (0, 4, 11, 15), size is 100px. For others, it's 80px.
                const size = (squareElement.classList.contains('corner') || squareId === 'square-0') ? 100 : 80;

                // Get the center point of the square relative to the board
                const x = squareElement.offsetLeft + size / 2;
                const y = squareElement.offsetTop + size / 2;
                return { x, y };
            }
            // Fallback for safety, though should not happen with correctSquareOrder
            return { x: 260, y: 260 }; 
        }

        // ç”±æ–¼æ‚¨çš„ HTML åªå®šç¾©äº† 18 å€‹æ ¼å­ (0-4, 7-10, 11-15, 16-19)ï¼Œ
        // æˆ‘æœƒå°‡ `numSquares` æ”¹ç‚º 18ï¼Œæˆ–è€…æ‚¨éœ€è¦è£œå…… square-5 å’Œ square-6 çš„ HTML å’Œ CSSã€‚
        // **å»ºè­°æ‚¨åœ¨ <script> æ¨™ç±¤ä¸­å°‡ numSquares = 20 æ”¹ç‚º numSquares = 18ã€‚**
        // const numSquares = 18; // ä¿®æ­£æ ¼å­ç¸½æ•¸

        /**
         * ç§»å‹•æ£‹å­åˆ°æ–°çš„ä½ç½®ä¸­å¿ƒï¼Œä¸¦ç‚ºå¤šå€‹ç©å®¶æä¾›å¾®å°åç§»
         * @param {number} player - ç©å®¶ç·¨è™Ÿ 1 æˆ– 2
         * @param {number} newPos - æ–°çš„æ ¼å­ç´¢å¼• (åœ¨ correctSquareOrder ä¸­çš„ç´¢å¼•)
         */
        const movePlayerToken = (player, newPos) => {
            const token = (player === 1) ? player1Token : player2Token;
            const coords = getSquareCenter(newPos);
            const tokenHalf = 14; // æ£‹å­å¯¬åº¦/2 (28px / 2)
            
            // ç©å®¶ 1 å‘å·¦å¾®èª¿ï¼Œç©å®¶ 2 å‘å³å¾®èª¿ï¼Œä½¿å…¶åœ¨åŒä¸€æ ¼æ™‚ç¨å¾®éŒ¯é–‹
            // Horizontal offset: -5 for P1, 5 for P2
            const offsetX = (player === 1) ? -5 : 5; 

            // `coords.x - tokenHalf` is the center point, then add offsetX for player separation
            token.style.left = `${coords.x - tokenHalf + offsetX}px`;
            token.style.top = `${coords.y - tokenHalf}px`;
        };

        const rollDice = () => {
            rollDiceButton.disabled = true;
            rollDiceButton.textContent = 'æ“²éª°ä¸­...';
            const diceRoll = Math.floor(Math.random() * 6) + 1;
            diceResultDiv.textContent = 'ğŸ²';
            let rollCount = 0;
            const interval = setInterval(() => {
                diceResultDiv.textContent = `ğŸ² ${Math.floor(Math.random() * 6) + 1}`;
                rollCount++;
                if (rollCount > 10) {
                    clearInterval(interval);
                    ///diceResultDiv.textContent = `æ“²å‡º: ${diceRoll}`;
                    document.getElementById('dice-result').textContent = "ğŸ²";  ///new
                    
                    let currentPos = playerPositions[currentPlayer];
                    let newPos = (currentPos + diceRoll);
                    
                    // Pass Go logic
                    
                    if (newPos >= numSquares) { 
                        ///statusDiv.textContent = `ç©å®¶ ${currentPlayer} ç¶“éèµ·é»ï¼é ˜å–çå‹µï¼`; 
                        document.getElementById('system').textContent = `ç©å®¶ ${currentPlayer} ç¶“éèµ·é»ï¼é ˜å–çå‹µï¼`;  ///new
                    }
                    newPos = newPos % numSquares; // Use the correct numSquares (18)
                    
                    playerPositions[currentPlayer] = newPos;
                    movePlayerToken(currentPlayer, newPos);

                    setTimeout(() => {
                        const squareId = correctSquareOrder[newPos];
                        const squareText = document.getElementById(squareId)?.textContent.trim() || 'æœªçŸ¥æ ¼';
                        
                        currentPlayer = (currentPlayer === 1) ? 2 : 1;
                        ///statusDiv.textContent = `ç©å®¶ ${currentPlayer} çš„å›åˆ (${squareText})`;
                        statusDiv.textContent = `ç©å®¶ ${currentPlayer} çš„å›åˆ`;  ///new
                        document.getElementById('system').textContent = `(ä¸Šæ¬¡æœ‰äººæ“²å‡ºã€Œ${diceRoll}ã€è¸©åˆ°ã€Œ${squareText}ã€)`;  ///new

                        rollDiceButton.disabled = false;
                        rollDiceButton.textContent = 'æ“²éª°å­';
                    }, 1000);


                }
            }, 100);
        };

        window.onload = function () {
            rollDiceButton.addEventListener('click', rollDice);
            // Start position is path index 0
            movePlayerToken(1, 0); 
            movePlayerToken(2, 0);
        };
    </script>
</body>
</html>
