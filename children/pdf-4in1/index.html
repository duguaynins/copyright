
<!DOCTYPE html>
<html lang="en">
<head translate="yes">
  <meta charset="UTF-8">
  <link rel="icon" type="image/x-icon" sizes="48x48" href="data:image/x-icon;base64,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">
  <!--link rel="icon" type="image/x-icon" sizes="48x48" href="https://duguaynins-allninsone.hf.space/favicon.ico"-->
  <!--link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"-->
  <!--link rel="shortcut icon" href="/favicon.ico"-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title translate="no">nins/pdf-4in1</title>
  <style>
    body {
      overflow: hidden;
    }
  </style>
  <style>
    input, textarea, button, select {
      /*font-size: inherit; /* ä¸»å‹•ç¹¼æ‰¿ body å­—é«”å¤§å° */
      font-size: 18px;
    }
    html, body { font-size: 14px; }
    html, body {
      margin: 0;
      /*font-family: Arial, sans-serif;*/
      background-color: #ffffff;
      background-color: #000000;
      background-color: #cdcdcd;
      color: #333;
      user-select: none;
    }

    header {
      text-align: center;
      padding: 2rem 1rem;
      border-bottom: 1px solid #ddd;
    }

    header h1 {
      margin: 0;
      font-size: 2.5rem;
    }

    .intro {
      text-align: center;
      padding: 1rem 2rem;
      max-width: 700px;
      margin: auto;
    }
  </style>
  
  <style>
  
    @keyframes blink {
      0% { border-color: black; }
      50% { border-color: transparent; }
      100% { border-color: black; }
    }
    
    #BOTTOM {
        height: 100vh;  /* è¦–çª—é«˜åº¦å¯æ”¹æˆä½ éœ€è¦çš„é«˜åº¦ */
        width: 100vw;
        background-color: #000000;
        background-color: #cdcdcd;
        color: #333;
    }
    .container {
      position: relative;  /* çˆ¶å®¹å™¨è¨­å®šç‚º relativeï¼Œä»¥ä¾¿å­å…ƒç´ çš„ absolute å®šä½èƒ½ç›¸å°æ–¼å®ƒ */
      width: 100%;
      height: 100%;
      background: #eee;
      color: black;
    }
  </style>
  <style>
      .skiptranslate {
        display: none !important;   /* é¿å… display:none å½±éŸ¿å…§å®¹é¡¯ç¤º */
        position: static !important;   /* é˜²æ­¢ä½ç½®ç•°å¸¸ */
        width: 0px !important;
        height: 0px !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        background: none !important;
        /*font-size: inherit !important;*/
      }
      iframe {
        display: none !important;
      }
  </style>

  <style>
    @keyframes fadeGradient {
      from {
        background: linear-gradient(white, white);
      }
      to {
        background: linear-gradient(white, transparent);
      }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    
    @keyframes hardBlink {
      0%, 100% { border-color: red; }
      50%      { border-color: transparent; }
    }
    .main {
        border: 2px solid red;
        padding: 8px;
        /**animation: blinkBorder 1s infinite;  //===*/
        /* å‘¼å¸å¼å‹•ç•«ï¼šå¹³æ»‘éæ¸¡ */
        /**animation: blinkBorder 1s ease-in-out infinite;  //===*/
        /* é–ƒçˆå¼å‹•ç•«ï¼šç¬é–“åˆ‡æ› */
        animation: hardBlink 1.0s steps(1, start) infinite;
    }
    
    input:hover {
      background-color: #cdcdcd;    ///FF3B00;
      color: black;///gray;
    }
    input:active {
      background-color: #222222;  ///#004080;
      color: white;///gray;
    }
    input:focus {
      outline: none;              /* ç§»é™¤é è¨­è—è‰²é‚Šæ¡† */
      /* border: 2px solid #4CAF50;  æ”¹ç‚ºç¶ è‰²é‚Šæ¡† */
      /* box-shadow: 0 0 5px #4CAF50; */
      border: 2px solid red;       /* æˆ–ä½¿ç”¨ #f44336 */
      box-shadow: 0 0 5px red;
    }
    .twod {
      /*width: 100vmin;
      height: 100vmin;*/
    }
    .oned {
      /*width: 100vmin;
      height: 10vmin;*/
    }
    .thumb { 
      /*width: 87vw;*/
      width: 100px;
      height: 60px;
      margin: 0.5em;
      padding: 0.5em; /* é€™è£¡å¢åŠ 5åƒç´ çš„å…§è·é›¢ */
      cursor: pointer;
      border: 1px solid #ccc;
      object-fit: contain;
      display: none;
      flex-shrink: 0;        /* é˜²æ­¢è¢«å£“ç¸® */
    }
  </style>
</head>
<body>
    <div id="google_translate_element" style="display:none;"></div>
  
    
    <button disabled="" id="disabled" style="
      position: fixed;
      bottom: 0;
      top: 0; /* è·é›¢é ‚éƒ¨ 0 */
      left: 0; /* è·é›¢å·¦å´ 0 */
      right: 0; /* è·é›¢å³å´ 0 */
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      margin: 0;
      /*opacity: 0;  /*ä¸é€æ˜åº¦*/
      /*background: transparent;  /*ä¸é€æ˜åº¦ï¼Ÿ*/
      cursor: default;
      z-index: 99999;  /* ç¢ºä¿åœ¨æœ€é«˜å±¤ */
      /*background: linear-gradient(white, transparent);*/
      background: white;
      animation: fadeOut 3s forwards;
      pointer-events: none;  /* å‹•ç•«æœŸé–“ä¸é˜»æ“‹äº’å‹•ï¼ˆå¯é¸ï¼‰*/
    "></button>
    
    
    <div style="
      position: fixed;
      bottom: 0;
      top: 0; /* è·é›¢é ‚éƒ¨ 0 */
      left: 0; /* è·é›¢å·¦å´ 0 */
      right: 0; /* è·é›¢å³å´ 0 */
      background: #777777;
      background: #FF3B00;
      background: white;
      color: white;
      text-align: center;
      /*padding: 10px;*/
      box-sizing: border-box;
      word-break: break-word;
      z-index: 9998;
      
      display: flex;
      flex-direction: column;
    ">
          <div style="background: #FFFFFF; color: black;" translate="no">
          <div style="margin: 10px;" onclick="document.getElementById('DialogShare').showModal()">
          nins/pdf-4in1
          </div></div>
          
              <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->
              <div style="background: #FFFFFF; overflow:auto; width:100%; flex:1; border: 1px solid #ccc;">
                  <div style="color:#000000" id="status">Please select a PDF file...</div><br>
                  
                  <button id="selectBtn" onclick="document.getElementById('pdfFile').click()">ğŸ“‚PDFğŸ’¾</button>
                  <br>
                  <button id="processBtn" onclick="processPdf()" disabled translate="no">âœ¨4in1â­</button>

                  <!--input style="color:#000000" type="file" id="pdfFile" accept=".pdf"><br-->
                  <input style="color:#000000;display:none" type="file" id="pdfFile" accept=".pdf" onchange="document.getElementById('displayText').textContent = this.files[0] ? this.files[0].name : 'å°šæœªé¸æ“‡æª”æ¡ˆ'">
                  <div style="color:#000000;display:none" id="displayText">é€™è£¡æœƒé¡¯ç¤ºæª”æ¡ˆåç¨±</div>
              </div>
              <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->
            
          <!--strong></strong-->
          <div style="background: #FF3B00; color: white;" translate="yes">
          <div style="margin: 10px;" onclick="document.getElementById('DialogTool').showModal()">
          By sending a message to this service, it means you have agreed to any content and all content!
          </div></div>
    </div>
    
    <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->
     <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
     <script>
        const { PDFDocument } = PDFLib;

        // Define standard A4 dimensions (Width, Height)
        const A4_PORTRAIT_WIDTH = 595.28;
        const A4_PORTRAIT_HEIGHT = 841.89;
        const A4_LANDSCAPE_WIDTH = A4_PORTRAIT_HEIGHT;
        const A4_LANDSCAPE_HEIGHT = A4_PORTRAIT_WIDTH;

        // Listen for file selection event
        document.getElementById('pdfFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const button = document.getElementById('processBtn');
            ///button.disabled = !file;
            
            document.getElementById('processBtn').disabled = !file;
            document.getElementById('selectBtn').disabled = file;
            ///document.getElementById('processBtn').style.display = !file ? 'none' : 'block';
            ///document.getElementById('selectBtn').style.display = file ? 'none' : 'block';


            document.getElementById('status').textContent = file ? `âœ… Can use 4 in 1: ${file.name}` : 'Please select a PDF file...';
        });

        async function processPdf() {
            const fileInput = document.getElementById('pdfFile');
            const statusDiv = document.getElementById('status');
            const processBtn = document.getElementById('processBtn');

            const file = fileInput.files[0];
            if (!file) return;

            processBtn.disabled = true;
            statusDiv.textContent = 'â³ Processing, please wait...';

            try {
                const arrayBuffer = await file.arrayBuffer();
                const existingPdfDoc = await PDFDocument.load(arrayBuffer);
                const newPdfDoc = await PDFDocument.create();

                const pages = existingPdfDoc.getPages();
                const numPages = pages.length;

                // 1. Embed all pages
                const importedPages = [];
                statusDiv.textContent = `â³ Embedding ${numPages} original pages...`;
                
                for (const page of pages) {
                    const embeddedPage = await newPdfDoc.embedPage(page);
                    importedPages.push(embeddedPage);
                }
                
                statusDiv.textContent = 'â³ Smartly laying out 4-up...';
                
                // 2. Perform 4-up grouping and drawing
                for (let i = 0; i < numPages; i += 4) {
                    const groupPages = importedPages.slice(i, i + 4);
                    
                    // --- Smartly determine new page orientation ---
                    let portraitCount = 0;
                    for (const page of groupPages) {
                        // Determine page orientation: Height > Width is considered Portrait
                        if (page.height > page.width) {
                            portraitCount++;
                        }
                    }

                    // Set new page dimensions based on the majority page orientation
                    const isPortrait = portraitCount >= groupPages.length / 2;
                    let newPageWidth, newPageHeight;
                    
                    if (isPortrait) {
                        newPageWidth = A4_PORTRAIT_WIDTH;
                        newPageHeight = A4_PORTRAIT_HEIGHT;
                    } else {
                        newPageWidth = A4_LANDSCAPE_WIDTH;
                        newPageHeight = A4_LANDSCAPE_HEIGHT;
                    }
                    
                    const newPage = newPdfDoc.addPage([newPageWidth, newPageHeight]);
                    
                    // Recalculate grid dimensions
                    const cellWidth = newPageWidth / 2;
                    const cellHeight = newPageHeight / 2;

                    // Define the drawing position for each small page (Top-Left is the origin 0, 0)
                    const positions = [
                        { x: 0, y: cellHeight },       // Top-Left (Original Page 1)
                        { x: cellWidth, y: cellHeight },// Top-Right (Original Page 2)
                        { x: 0, y: 0 },                  // Bottom-Left (Original Page 3)
                        { x: cellWidth, y: 0 }           // Bottom-Right (Original Page 4)
                    ];

                    // --- Draw Pages ---
                    for (let j = 0; j < 4; j++) {
                        const originalPageIndex = i + j;
                        
                        if (originalPageIndex < numPages) { 
                            const originalPage = importedPages[originalPageIndex]; 
                            const { x, y } = positions[j];

                            const originalWidth = originalPage.width;
                            const originalHeight = originalPage.height;
                            
                            // Calculate scaling factor to ensure content fits completely within the cell's width or height
                            const scaleX = cellWidth / originalWidth;
                            const scaleY = cellHeight / originalHeight;
                            const scale = Math.min(scaleX, scaleY); // Ensure it does not exceed the cell boundary
                            
                            const scaledWidth = originalWidth * scale;
                            const scaledHeight = originalHeight * scale;

                            // Center the content within the grid (Optional: for a better layout)
                            const offsetX = x + (cellWidth - scaledWidth) / 2;
                            const offsetY = y + (cellHeight - scaledHeight) / 2;

                            // Draw the page
                            newPage.drawPage(originalPage, { 
                                x: offsetX,
                                y: offsetY,
                                width: scaledWidth,
                                height: scaledHeight,
                            });
                        }
                    }
                }

                // 3. Output and download the new PDF document
                const pdfBytes = await newPdfDoc.save();
                
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `rearranged_4up_smart_${file.name}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                statusDiv.textContent = 'âœ… Output complete! Download has started.';

            } catch (error) {
                console.error('An error occurred while processing the PDF:', error);
                statusDiv.textContent = `âŒ Processing failed. Error message: ${error.message}`;
            } finally {
                document.getElementById('processBtn').disabled = false;
                ///document.getElementById('selectBtn').disabled = true;
            }
        }
    </script>
    <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->

    <script type="text/javascript">  // google.js
      // GOOGLE TRANSLATE
      // è‡ªå‹•ç¿»è­¯***
      ///document.cookie = "googtrans=/en/zh-TW; path=/";
      ///location.reload();
    
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({
          pageLanguage: 'en',  ///'en', æ”¹ç‚ºæ ¹æ“šä¸­é–“èªè¨€(ilang) æˆ– é é¢èªè¨€(locale)  ///é¼“å‹µè¼¸å…¥ä¸­é–“èªè¨€ï¼Œç¿»è­¯å¿…å®šå¯ä»¥é¡¯ç¤ºè‹±æ–‡ã€‚
          includedLanguages: '',  ///zh-TW,ja,ko,en,hi,zh-CN
          autoDisplay: false,
          ///layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');
      }
      
    
      function autoTranslate(lang) {
        const tryTranslate = () => {
          const combo = document.querySelector('.goog-te-combo');
          if (combo) {
            combo.value = lang;
            combo.dispatchEvent(new Event('change'));
          } else {
            setTimeout(tryTranslate, 300); // éè¿´æª¢æŸ¥
          }
        };
        tryTranslate();
      }
    
      window.addEventListener('load', () => {
        setTimeout(() => {
          const tlang = navigator.language || navigator.userLanguage || "en-US";
          autoTranslate(tlang);
          
          ///document.getElementById(":1.container").style.display = "";
        }, 1500);
      });
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    
</body>
</html>
